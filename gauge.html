<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<title>Chỉ số sức mạnh thị trường</title>
<style>
  body { 
    font-family: Arial, sans-serif; 
    display:flex; 
    flex-direction:column; 
    align-items:center; 
    justify-content:center; 
    min-height:100vh; 
    background:#f3f4f6; 
    margin:0; 
  }
  h2 { margin-bottom:6px; }
  svg { width:420px; max-width:95vw; }
  .value { margin-top:8px; font-weight:700; font-size:18px; color:#222; }
</style>
</head>
<body>
  <h2>Chỉ số sức mạnh thị trường (0–100)</h2>

  <svg viewBox="0 0 420 260" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="grad" x1="0%" x2="100%">
        <stop offset="0%" stop-color="#2ecc71"/>
        <stop offset="50%" stop-color="#f1c40f"/>
        <stop offset="100%" stop-color="#e74c3c"/>
      </linearGradient>
    </defs>

    <!-- dải màu -->
    <path d="M 50 200 A 150 150 0 0 1 350 200" fill="none" stroke="url(#grad)" stroke-width="28" stroke-linecap="round"/>
    <path d="M 55 200 A 145 145 0 0 1 345 200" fill="none" stroke="#fff" stroke-width="20" stroke-linecap="round" opacity="0.6"/>

    <!-- vạch chia -->
    <text x="50" y="210">0</text>
    <text x="130" y="115">25</text>
    <text x="200" y="85">50</text>
    <text x="270" y="115">75</text>
    <text x="350" y="210">100</text>

    <!-- kim -->
    <g id="needleGroup" transform="translate(200,170)">
      <g id="needle" style="transform-origin:50% 80%;">
        <path d="M0,0 L0,-110" stroke="#222" stroke-width="6" stroke-linecap="round"/>
        <polygon points="0,-120 8,-100 -8,-100" fill="#222"/>
      </g>
      <circle cx="0" cy="0" r="10" fill="#222"/>
    </g>

    <!-- nhãn -->
    <text id="statusLabel" x="200" y="160" text-anchor="middle" font-size="14" fill="#222" font-weight="600"></text>
  </svg>

  <div class="value" id="valText">--</div>

<script>
function valueToAngle(v){ v=Math.max(0,Math.min(100,v)); return (v/100)*180-90; }
function setGauge(value){
  const a=valueToAngle(value);
  document.getElementById('needle').style.transform=`rotate(${a}deg)`;
  document.getElementById('valText').textContent=value.toFixed(2)+" / 100";
  const lbl=document.getElementById('statusLabel');
  if(value<=30){lbl.textContent="Yếu";lbl.style.fill="#2ecc71";}
  else if(value<70){lbl.textContent="Trung bình";lbl.style.fill="#f1c40f";}
  else{lbl.textContent="Mạnh";lbl.style.fill="#e74c3c";}
}
async function updateFromApi(){
  try{
    const res=await fetch('http://localhost:8000/api/market-strength');
    const data=await res.json();
    const v=Number(data.score||0);
    setGauge(v);
  }catch(e){console.error(e);setGauge(0);}
}
updateFromApi();
setInterval(updateFromApi,10000);
</script>
</body>
</html>
